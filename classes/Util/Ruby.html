<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Util::Ruby</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Util::Ruby</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/nuggets/util/ruby_rb.html">
                lib/nuggets/util/ruby.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Heavily based on Phusion Passenger&#8216;s PlatformInfo module; see <a
href="https://github.com/FooBarWidget/passenger/blob/release-3.0.2/lib/phusion_passenger/platform_info/ruby.rb">their
code</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000109">command_for_ruby_tool</a>&nbsp;&nbsp;
      <a href="#M000108">locate_ruby_tool</a>&nbsp;&nbsp;
      <a href="#M000111">locate_ruby_tool_by_basename</a>&nbsp;&nbsp;
      <a href="#M000101">ruby_command</a>&nbsp;&nbsp;
      <a href="#M000102">ruby_executable</a>&nbsp;&nbsp;
      <a href="#M000110">ruby_options_to_argv</a>&nbsp;&nbsp;
      <a href="#M000107">ruby_sudo_command</a>&nbsp;&nbsp;
      <a href="#M000103">ruby_supports_fork?</a>&nbsp;&nbsp;
      <a href="#M000104">rvm?</a>&nbsp;&nbsp;
      <a href="#M000105">rvm_path</a>&nbsp;&nbsp;
      <a href="#M000106">rvm_ruby_string</a>&nbsp;&nbsp;
      <a href="#M000112">shebang_command</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CONFIG</td>
          <td>=</td>
          <td class="context-item-value">RbConfig::CONFIG</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">GEM_HOME</td>
          <td>=</td>
          <td class="context-item-value">gem_home</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">RUBY_ENGINE</td>
          <td>=</td>
          <td class="context-item-value">defined?(::RUBY_ENGINE) ? ::RUBY_ENGINE : 'ruby'</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">OSX_RUBY_RE</td>
          <td>=</td>
          <td class="context-item-value">%r{\A/System/Library/Frameworks/Ruby.framework/Versions/.*?/usr/bin/ruby\Z}</td>
        </tr>
        </table>
      </div>
    </div>



      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">command_for_ruby_tool</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the correct command string for invoking the <tt>name</tt>
executable that belongs to the current <a href="Ruby.html">Ruby</a>
interpreter. Returns nil if the command is not found.
</p>
<p>
If the command executable is a <a href="Ruby.html">Ruby</a> program, then
we need to run it in the correct <a href="Ruby.html">Ruby</a> interpreter
just in case the command doesn&#8216;t have the correct shebang line; we
don&#8216;t want a totally different <a href="Ruby.html">Ruby</a> than the
current one to be invoked.
</p>
<p>
If it&#8216;s not a <a href="Ruby.html">Ruby</a> program then it&#8216;s
probably a wrapper script as is the case with e.g. RVM (~/.rvm/wrappers).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 226</span>
226:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">command_for_ruby_tool</span>(<span class="ruby-identifier">name</span>)
227:       <span class="ruby-identifier">filename</span> = <span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">send</span>(<span class="ruby-identifier">name</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">locate_ruby_tool</span>(<span class="ruby-identifier">name</span>)
228:       <span class="ruby-identifier">shebang_command</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/ruby/</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{ruby_command} #{filename}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">filename</span>
229:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">locate_ruby_tool</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Locates a <a href="Ruby.html">Ruby</a> tool command <tt>name</tt>, e.g.
&#8216;gem&#8217;, &#8216;rake&#8217;, &#8216;bundle&#8217;, etc. Instead
of naively looking in $PATH, this function uses a variety of search
heuristics to find the command that&#8216;s really associated with the
current <a href="Ruby.html">Ruby</a> interpreter. It should never locate a
command that&#8216;s actually associated with a different <a
href="Ruby.html">Ruby</a> interpreter.
</p>
<p>
NOTE: The return value may not be the actual correct invocation for the
tool. Use <a href="Ruby.html#M000109">command_for_ruby_tool</a> for that.
</p>
<p>
Returns nil when nothing&#8216;s found.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 198</span>
198:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">locate_ruby_tool</span>(<span class="ruby-identifier">name</span>)
199:       <span class="ruby-identifier">extensions</span> = [<span class="ruby-value str">''</span>, <span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'EXEEXT'</span>]].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
200: 
201:       <span class="ruby-comment cmt"># Deduce Ruby's --program-prefix and --program-suffix from its install name</span>
202:       <span class="ruby-comment cmt"># and transform the given input name accordingly.</span>
203:       <span class="ruby-comment cmt">#</span>
204:       <span class="ruby-comment cmt">#   &quot;rake&quot; =&gt; &quot;jrake&quot;, &quot;rake1.8&quot;, etc</span>
205:       [<span class="ruby-identifier">name</span>, <span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'RUBY_INSTALL_NAME'</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-value str">'ruby'</span>, <span class="ruby-identifier">name</span>)].<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">basename</span><span class="ruby-operator">|</span>
206:         <span class="ruby-identifier">extensions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ext</span><span class="ruby-operator">|</span>
207:           <span class="ruby-identifier">result</span> = <span class="ruby-identifier">locate_ruby_tool_by_basename</span>(<span class="ruby-node">&quot;#{basename}#{ext}&quot;</span>)
208:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">result</span>
209:         }
210:       }
211: 
212:       <span class="ruby-keyword kw">nil</span>
213:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">ruby_command</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns correct command for invoking the current <a
href="Ruby.html">Ruby</a> interpreter. In case of RVM this function will
return the path to the RVM wrapper script that executes the current <a
href="Ruby.html">Ruby</a> interpreter in the currently active gem set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
    <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 76</span>
76:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_command</span>
77:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ruby_command</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@ruby_command</span>)
78: 
79:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ruby_command</span> = <span class="ruby-identifier">ruby_executable</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rvm?</span>
80: 
81:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">name</span> = <span class="ruby-identifier">rvm_ruby_string</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">rvm_path</span>
82:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-value str">'wrappers'</span>, <span class="ruby-identifier">name</span>, <span class="ruby-value str">'ruby'</span>))
83:           <span class="ruby-comment cmt"># Old wrapper scripts reference $HOME which causes</span>
84:           <span class="ruby-comment cmt"># things to blow up when run by a different user.</span>
85:           <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@ruby_command</span> = <span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'$HOME'</span>)
86:         <span class="ruby-keyword kw">end</span>
87: 
88:         <span class="ruby-identifier">abort</span> <span class="ruby-value str">'Your RVM wrapper scripts are too old. '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">UPDATE_RVM</span>
89:       <span class="ruby-keyword kw">end</span>
90: 
91:       <span class="ruby-comment cmt"># Something's wrong with the user's RVM installation.</span>
92:       <span class="ruby-comment cmt"># Raise an error so that the user knows this instead of</span>
93:       <span class="ruby-comment cmt"># having things fail randomly later on.</span>
94:       <span class="ruby-comment cmt"># 'name' is guaranteed to be non-nil because rvm_ruby_string</span>
95:       <span class="ruby-comment cmt"># already raises an exception on error.</span>
96:       <span class="ruby-identifier">abort</span> <span class="ruby-value str">'Your RVM installation appears to be broken: the RVM path cannot be found. '</span> <span class="ruby-operator">&lt;&lt;</span>
97:             <span class="ruby-value str">'Please fix your RVM installation or contact the RVM developers for support.'</span>
98:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">ruby_executable</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the full path to the current <a href="Ruby.html">Ruby</a>
interpreter&#8216;s executable file. This might not be the actual correct
command to use for invoking the <a href="Ruby.html">Ruby</a> interpreter;
use <a href="Ruby.html#M000101">ruby_command</a> instead.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_executable</span>
104:       <span class="ruby-ivar">@ruby_executable</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
105:         <span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">ext</span> = <span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">values_at</span>(<span class="ruby-operator">*</span><span class="ruby-node">%w[bindir RUBY_INSTALL_NAME EXEEXT]</span>)
106:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ext</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/.*\s.*/</span><span class="ruby-identifier">m</span>, <span class="ruby-value str">'&quot;\&amp;&quot;'</span>)
107:       <span class="ruby-keyword kw">end</span>
108:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">ruby_options_to_argv</span><span class="method-args">(args, ruby_command = ruby_command)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 244</span>
244:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_options_to_argv</span>(<span class="ruby-identifier">args</span>, <span class="ruby-identifier">ruby_command</span> = <span class="ruby-identifier">ruby_command</span>)
245:       <span class="ruby-identifier">argv</span> = [<span class="ruby-identifier">ruby_command</span>]
246: 
247:       <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
248:         <span class="ruby-identifier">opt</span> = <span class="ruby-node">&quot;-#{key.to_s[0, 1]}&quot;</span>
249: 
250:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
251:           <span class="ruby-identifier">val</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">wal</span><span class="ruby-operator">|</span>
252:             <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opt</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">wal</span>.<span class="ruby-identifier">to_s</span>
253:           }
254:         <span class="ruby-keyword kw">else</span>
255:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opt</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'-e'</span>
256:             <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">opt</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_s</span>
257:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">val</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
258:             <span class="ruby-identifier">argv</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;#{opt}#{val unless val == true}&quot;</span>
259:           <span class="ruby-keyword kw">end</span>
260:         <span class="ruby-keyword kw">end</span>
261:       } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
262: 
263:       <span class="ruby-identifier">argv</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">args</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span> <span class="ruby-identifier">arg</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span> })
264:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">ruby_sudo_command</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns either &#8216;sudo&#8217; or &#8216;rvmsudo&#8217; depending on
whether the current <a href="Ruby.html">Ruby</a> interpreter is managed by
RVM.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 184</span>
184:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_sudo_command</span>
185:       <span class="ruby-node">&quot;#{'rvm' if rvm?}sudo&quot;</span>
186:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">ruby_supports_fork?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the <a href="Ruby.html">Ruby</a> interpreter supports
process forking.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 111</span>
111:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ruby_supports_fork?</span>
112:       <span class="ruby-comment cmt"># MRI &gt;= 1.9.2's respond_to? returns false for methods</span>
113:       <span class="ruby-comment cmt"># that are not implemented.</span>
114:       <span class="ruby-constant">Process</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:fork</span>) <span class="ruby-operator">&amp;&amp;</span>
115:       <span class="ruby-constant">RUBY_ENGINE</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'jruby'</span>     <span class="ruby-operator">&amp;&amp;</span>
116:       <span class="ruby-constant">RUBY_ENGINE</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">'macruby'</span>   <span class="ruby-operator">&amp;&amp;</span>
117:       <span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'target_os'</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin|windows|mingw/</span>
118:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">rvm?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the current <a href="Ruby.html">Ruby</a> interpreter is
managed by RVM.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 121</span>
121:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rvm?</span>
122:       <span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'bindir'</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r{/\.?rvm/}</span>
123:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">rvm_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If the current <a href="Ruby.html">Ruby</a> interpreter is managed by RVM,
returns the directory in which RVM places its working files. Otherwise
returns nil.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 128</span>
128:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rvm_path</span>
129:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@rvm_path</span>)
130: 
131:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_path</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rvm?</span>
132: 
133:       [<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'rvm_path'</span>], <span class="ruby-value str">'~/.rvm'</span>, <span class="ruby-value str">'/usr/local/rvm'</span>].<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
134:         <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>)
135:         <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_path</span> = <span class="ruby-identifier">path</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">path</span>)
136:       }
137: 
138:       <span class="ruby-comment cmt"># Failure to locate the RVM path is probably caused by the</span>
139:       <span class="ruby-comment cmt"># user customizing $rvm_path. Older RVM versions don't</span>
140:       <span class="ruby-comment cmt"># export $rvm_path, making us unable to detect its value.</span>
141:       <span class="ruby-identifier">abort</span> <span class="ruby-value str">'Unable to locate the RVM path. Your RVM '</span> <span class="ruby-operator">&lt;&lt;</span>
142:             <span class="ruby-value str">'installation is probably too old. '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">UPDATE_RVM</span>
143:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">rvm_ruby_string</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If the current <a href="Ruby.html">Ruby</a> interpreter is managed by RVM,
returns the RVM name which identifies the current <a
href="Ruby.html">Ruby</a> interpreter plus the currently active gemset,
e.g. something like this: &quot;ruby-1.9.2-p0@mygemset&quot;
</p>
<p>
Returns nil otherwise.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 151</span>
151:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rvm_ruby_string</span>
152:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_ruby_string</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@rvm_ruby_string</span>)
153: 
154:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_ruby_string</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">rvm?</span>
155: 
156:       <span class="ruby-comment cmt"># RVM used to export the necessary information through</span>
157:       <span class="ruby-comment cmt"># environment variables, but doesn't always do that anymore</span>
158:       <span class="ruby-comment cmt"># in the latest versions in order to fight env var pollution.</span>
159:       <span class="ruby-comment cmt"># Scanning $LOAD_PATH seems to be the only way to obtain</span>
160:       <span class="ruby-comment cmt"># the information.</span>
161: 
162:       <span class="ruby-comment cmt"># Getting the RVM name of the Ruby interpreter (&quot;ruby-1.9.2&quot;)</span>
163:       <span class="ruby-comment cmt"># isn't so hard, we can extract it from the #ruby_executable</span>
164:       <span class="ruby-comment cmt"># string. Getting the gemset name is a bit harder, so let's</span>
165:       <span class="ruby-comment cmt"># try various strategies...</span>
166: 
167:       <span class="ruby-comment cmt"># $GEM_HOME usually contains the gem set name.</span>
168:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_ruby_string</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-constant">GEM_HOME</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GEM_HOME</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">GEM_HOME</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-value str">'rvm/gems/'</span>)
169: 
170:       <span class="ruby-comment cmt"># User somehow managed to nuke $GEM_HOME. Extract info from $LOAD_PATH.</span>
171:       <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@rvm_ruby_string</span> = <span class="ruby-identifier">$1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">path</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r{^.*rvm/gems/([^/]+)}</span> }
172: 
173:       <span class="ruby-comment cmt"># On Ruby 1.9, $LOAD_PATH does not contain any gem paths until</span>
174:       <span class="ruby-comment cmt"># at least one gem has been required so the above can fail.</span>
175:       <span class="ruby-comment cmt"># We're out of options now, we can't detect the gem set.</span>
176:       <span class="ruby-comment cmt"># Raise an exception so that the user knows what's going on</span>
177:       <span class="ruby-comment cmt"># instead of having things fail in obscure ways later.</span>
178:       <span class="ruby-identifier">abort</span> <span class="ruby-value str">'Unable to autodetect the currently active RVM gem set '</span> <span class="ruby-operator">&lt;&lt;</span>
179:             <span class="ruby-value str">&quot;name. Please contact this program's author for support.&quot;</span>
180:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Private Instance methods</h3>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">locate_ruby_tool_by_basename</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 268</span>
268:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">locate_ruby_tool_by_basename</span>(<span class="ruby-identifier">name</span>)
269:       <span class="ruby-identifier">dir</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/darwin/</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ruby_command</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">OSX_RUBY_RE</span>
270:         <span class="ruby-comment cmt"># On OS X we must look for Ruby binaries in /usr/bin.</span>
271:         <span class="ruby-comment cmt"># RubyGems puts executables (e.g. 'rake') in there, not in</span>
272:         <span class="ruby-comment cmt"># /System/Libraries/(...)/bin.</span>
273:         <span class="ruby-value str">'/usr/bin'</span>
274:       <span class="ruby-keyword kw">else</span>
275:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">ruby_command</span>)
276:       <span class="ruby-keyword kw">end</span>
277: 
278:       <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-identifier">name</span>)
279:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-identifier">filename</span>)
280: 
281:       <span class="ruby-comment cmt"># RubyGems might put binaries in a directory other</span>
282:       <span class="ruby-comment cmt"># than Ruby's bindir. Debian packaged RubyGems and</span>
283:       <span class="ruby-comment cmt"># DebGem packaged RubyGems are the prime examples.</span>
284:       <span class="ruby-keyword kw">begin</span>
285:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'rubygems'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Gem</span>)
286: 
287:         <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Gem</span>.<span class="ruby-identifier">bindir</span>, <span class="ruby-identifier">name</span>)
288:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-identifier">filename</span>)
289:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">LoadError</span>
290:       <span class="ruby-keyword kw">end</span>
291: 
292:       <span class="ruby-comment cmt"># Looks like it's not in the RubyGems bindir. Search in $PATH, but</span>
293:       <span class="ruby-comment cmt"># be very careful about this because whatever we find might belong</span>
294:       <span class="ruby-comment cmt"># to a different Ruby interpreter than the current one.</span>
295:       <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'PATH'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>).<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
296:         <span class="ruby-identifier">filename</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">name</span>)
297: 
298:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-identifier">filename</span>)
299:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">shebang_command</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">ruby_command</span>
300:         <span class="ruby-keyword kw">end</span>
301:       }
302: 
303:       <span class="ruby-keyword kw">nil</span>
304:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">shebang_command</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
     <span class="ruby-comment cmt"># File lib/nuggets/util/ruby.rb, line 306</span>
306:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shebang_command</span>(<span class="ruby-identifier">filename</span>)
307:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">foreach</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
308:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">$1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/\A#!\s*(\S*)/</span>
309: 
310:         <span class="ruby-comment cmt"># Allow one extra line for magic comment.</span>
311:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$.</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
312:       }
313:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>